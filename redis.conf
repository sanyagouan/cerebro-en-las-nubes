# ==========================================
# REDIS CONFIGURACIÓN - PRODUCCIÓN
# ==========================================

# --- BIND & PORT ---
bind 0.0.0.0
port 6379
protected-mode yes
requirepass ${REDIS_PASSWORD}

# --- PERSISTENCIA DE DATOS ---
# Habilitar AOF (Append Only File) para durabilidad
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec  # Balance entre rendimiento y seguridad

# Habilitar RDB (Redis Database) snapshots para recuperación rápida
save 900 1      # Guardar si al menos 1 key cambió en 900s (15 min)
save 300 10     # Guardar si al menos 10 keys cambiaron en 300s (5 min)
save 60 10000   # Guardar si al menos 10000 keys cambiaron en 60s

# --- MEMORIA ---
maxmemory 256mb
maxmemory-policy allkeys-lru  # Evictar keys menos recientes usadas cuando memoria está llena

# --- LOGGING ---
loglevel notice
logfile ""

# --- SECURITY ---
# Desabilitar comandos peligrosos en producción
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG ""
rename-command DEBUG ""

# --- PERFORMANCE ---
# Ajustar para producción
tcp-keepalive 300
tcp-backlog 511
timeout 0

# --- CLIENTES ---
# Máximo número de clientes conectados
maxclients 10000

# --- DATA COMPRESSION ---
# Comprimir valores de strings/objetos para ahorar espacio
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
set-max-intset-entries 512
set-max-intset-entries 64

# --- PERSISTENCIA ---
dir /data
dbfilename dump.rdb